<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>資料庫應用程式設計 期中筆記｜CJL's Notes WebSite</title>
    <link rel="stylesheet" href="../../css/sidebar.css">
    <link rel="stylesheet" href="../../css/main.css">
    <link rel="icon" href="../../img/notes2.png" type="image/x-icon" >
    <style>
        #im {
          background-color: yellow;
        };
    </style>
</head>
<body>
    <!-- The sidebar -->
    <div class="sidebar">
        <p><a  href="../../index.html"><img class ="img" src ="../../img/notes.png">&nbsp&nbsp陳杰龍的筆記網站</a></p>
        <a href="../../index.html"><img class ="img" src ="../../img/home.png">&nbsp&nbsp主頁</a>
        <a  href="../../archives.html"><img class ="img" src ="../../img/categories.png">&nbsp&nbsp歸檔</a>
        <a class="active" href="../../categories.html"><img class ="img" src ="../../img/file.png">&nbsp&nbsp分類</a>
        <a href="../../others.html"><img class ="img" src ="../../img/others.png">&nbsp&nbsp其他</a>
        <a href="../../about.html"><img class ="img" src ="../../img/self.png">&nbsp&nbsp關於我</a>
    </div>
    
    <!-- Page content -->

        
        <div class="content">
            


            <div style="width: 100%; text-align: center; ">
                <p><h2><a href="windows_program.html"><img style="vertical-align: bottom	;" src="../../img/Previouspage.png"></a>&nbsp資料庫應用程式設計&nbsp期中筆記</h2></p>
            </div>
            <br>
            <div style="width: 60%; text-align: left; margin-left: 20%;  padding-left: 10px;border-width:2px;  " >
             
                <p>
                    <h2>資料表欄位的資料型別</h2>
                    <li>bit：布林</li>
                    <li>int：整數</li>
                    <li>float：浮點數</li>
                    <li>money：貨幣</li>
                    <li>char(n)：固定長度字串，未填滿自動補上空白(英數字)</li>
                    <li>varchar(n)：不固定長度字串，儲存多少就佔多少空間(英數字)</li>
                    <li>nchar(n)：固定長度的Unicode字串，一個字2Bytes，未填滿自動補上空白(非英數以外的字元)</li>
                    <li>nvarchar(n)：不固定長度的Unicode字串，一個字2Bytes，儲存多少就佔多少空間(非英數以外的字元)</li>
                    <li>text：不固定長度的字串字串</li>
                    <li>ntext：不固定長度的Unicode字串</li>
                    <li>data：日期</li>
                    <li>datatime：時間</li>
                    <li>image：二進位資料，存圖片</li>
                </p>
                <br>
                <p>
                    <h2>SQL語法</h2>
                    <ul>
                        <li><span id="im">建立外來鍵</span><br>
                            CONSTRAINT [FK_員工_ToTable] FOREIGN KEY ([部門編號]) REFERENCES [部門]([部門編號])
                        </li>
                        <li>找出全部資料<br>SELECT * FROM 員工</li>
                        <li>特定資料<br>SELECT 員工編號, 電話 FROM 員工</li>
                        <li>別名<br>SELECT 員工編號 AS 識別編號, 電話 AS 連絡電話 FROM 員工</li>
                        <li>查詢紀錄筆數，後面加上WITH TIES為相同值也印出<br>SELECT TOP 2 * FROM 員工(前二筆)<br>SELECT TOP 50 PERCENT * FROM 員工(前50%)</li>
                        <li>加總與平均<br>SELECT 姓名, (測驗1+測驗2) AS 總成績, (測驗1+測驗2)/2 AS 平均 FROM 員工</li>
                        <li>條件<br>SELECT 姓名, (測驗1+測驗2) AS 總成績, (測驗1+測驗2)/2 AS 平均 FROM 員工 WHERE ((測驗1+測驗2)/2>70 AND 測驗1>90)</li>
                        <li>如果欄位的值是字串，需加上N，否則會被認為是字串<br>e.g. WHERE 帳號 = N'aaa1123' AND 密碼 = N'bbb321'<br></li>
                        <li>WHERE配合LIKE進行萬用字元查詢<br>SELECT * FROM 員工 WHERE (地址LIKEN'%北平東路%') </li>
                        <li>IN找出符合項目的值<br>SELECT * FROM 員工 WHERE 姓名 IN (N'陳杰龍')</li>
                        <li>ORDER BY排序，加上DESC為大到小，反之小到大<br>SELECT * FROM 員工 ORDER BY 測驗1<br>SELECT * FROM 員工 ORDER BY 測驗2 DESC
                            <br>                       
                        </li>
                        <li><a href="https://vector.cool/mysql-%E5%9C%96%E8%A7%A3-left-join-inner-joinright-join-%E7%9A%84%E5%B7%AE%E7%95%B0%E5%8F%8A%E7%AF%84%E4%BE%8B/">JOIN差異</a><br>
                            LEFT JOIN：SELECT * FROM 員工 LEFT JOIN 部門 ON 員工.部門編號 = 部門.部門編號
                        </li>
                        <li>聚合函數
                        　　<ul>
                             <li>SUM</li>
                             <li>AVG</li>
                             <li>MAX</li>
                             <li>MIN</li>
                             <li>COUNT：SELECT COUNT(*) AS 筆數 FROM 員工 </li>
                           </ul>
                        </li>
                        <li>寫入資料<br>SET IDENTITY_INSERT 部門 ON<br>

                            INSERT INTO 部門(部門編號, 部門名稱) VALUES (4, N'設計')</li>
                        <li>刪除資料<br>DELETE FROM 部門 WHERE 部門編號 = 4</li>
                        <li>更新資料<br>UPDATE 部門 SET 部門名稱=N'資料庫' WHERE 部門編號 = 6</li>
                    </ul>
                </p>
                <br>
                <p>
                    <h2>ADO.NET</h2>
                    <ul>
                        <li>ADO.NET是應用程式和資料庫來源之間的溝通橋樑</li>
                        <li>ADO.NET架構使得資料在處理的同時，不要一直和資料庫連線，而發生一直占用系統資源的現象</li>
                        <li>ADO.NET架構分成.NET Framework Data Provider(資料來源提供者)和DataSet(資料處理的核心)</li>
                        <li>.NET Framework Data Provider
                            <ul>
                                <li>物件
                                    <ul>
                                        <li>Connection：提供和資料來源的連接功能</li>
                                        <li>Command：提供執行存取資料庫命令，並傳送資料或修改資料的功能</li>
                                        <li>DataAdapter：擔任DataSet物件和資料來源的橋樑</li>
                                        <li>DataReader：透過Command物件執行SQL查詢命令取得資料流</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </p>
                <br>
                <p>
                    <h2>ADO.NET存取</h2>
                    using System.Data.SqlClient;<span id="im">引用命名空間</span><br>
                    SqlConnection cn = new SqlConnection();<span id="im">宣告SqlConnection cn物件</span><br>
                    cn.ConnectionString = @"Data Source=(LocalDB)\MSSQLLocalDB;" +<br>
                    &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp"AttachDbFilename=|DataDirectory|MyDB.mdf;" +<br>
                    &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp"Integrated Security = True";<span id="im">給予資料庫路徑</span><br>
                    cn.Open(); <span id="im">資料庫開啟</span><br>
                    cn.Close(); <span id="im">資料庫關閉</span><br>
                    cn.State == ConnectionState.Closed <span id="im">資料庫狀態為關閉</span><br>
                    cn.State == ConnectionState.Open    <span id="im">  資料庫狀態為開啟</span><br>
                    <br><br>
                    using(SqlConnection cn = new SqlConnection()){<br>
                        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp...<br>
                    }<span id="im">當離開using區塊，會自動釋放cn占用的資源</span><br>
                    <span id="im">使用應用程式組態檔存取資料庫路徑</span><br>專案上右鍵 => 屬性 => 設定<br>
                    <img width="800px" src="img/1.png"><br>
                    在程式再加入Properties.Settings.Default.connString<br><br>
                    <span id="im">建立DataReader物件</span><br> 
                    SqlCommand cmd = new SqlCommand("SELECT * FROM 員工", cn);<span id="im">先利用SqlCommand將要的資料抓出來</span><br>
                    SqlDataReader dr = cmd.ExecuteReader();  <span id="im">特過dr物件所提供的方法及屬性即可進行資料的瀏覽</span><br>
                    <span id="im"> DataReader常用成員</span>
                    <ul>
                        <li>FieldCount：有幾個欄位，從0開始</li>
                        <li>Item[i]：取得第ｉ欄</li>
                        <li>Item["欄位名稱"]：指定欄位名稱的欄位資料</li>
                        <li>GetName(i)：取得第i欄的欄位名稱，從0開始</li>
                    </ul>
                    <br><br>
                    <span id="im"> DataReader物件讀取資料表資料</span><br>
                    for (int i = 0; i < dr.FieldCount; i++)<br>
                    {<br>
                        &nbsp&nbsp&nbsp&nbsptextBox1.Text += dr.GetName(i) + "\t";<br>
                    }<br><br>
                    while (dr.Read())<br>
                    {<br>
                        &nbsp&nbsp&nbsp&nbspfor (int i = 0; i < dr.FieldCount; i++){<br>
                            &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptextBox1.Text += dr[i].ToString() + "\t";<br>
                            &nbsp&nbsp&nbsp&nbsp}<br>
                            &nbsp&nbsp&nbsp&nbsptextBox1.Text += "\r\n\r\n";<br>
                    }<br>
                    <span id="im">也可以用欄位名稱獲取資料</span><br>

                    textBox1.Text += dr["姓名"].ToString();<br><br>
                    string searchName = textBox2.Text;<br><br>
            
                    string selectCmd = $"SELECT * FROM 員工 WHERE 姓名=N'{searchName}'";<br>
                    string selectCmd2 = $"SELECT* FROM 員工 WHERE 姓名 Like N'%{searchName}%'";<br><br>
        
                    SqlCommand cmd = new SqlCommand(selectCmd2, cn);<br>
                    SqlDataReader dr = cmd.ExecuteReader();<br>
                    <span id="im">利用輸入姓名查詢員工</span>
                </p>
                <p>
                    <h2>DataSet物件</h2>
                    應用程式向資料庫獲取資料時，資料庫會將所擷取的全部資料傳給到DataSet中，<br>此時可以與資料庫中斷連線，更新完再和資料庫連結並更新到資料庫<br>
                    DataSet ds = new DataSet();<span id="im">建立DataSet物件</span><br><br>

                    SqlDataAdapter daEmployee = new SqlDataAdapter("SELECT * FROM 員工", cn);<span id="im">建立SqlDataAdapter物件，並查詢出來</span><br>
                    SqlDataAdapter daDeperment = new SqlDataAdapter("SELECT * FROM 部門", cn);<span id="im">建立SqlDataAdapter物件，並查詢出來</span><br><br>
        
                    daEmployee.Fill(ds, "員工");<span id="im">Fill方法將查詢結果放到DataSet裡面並命名為員工，產生一個DataTable</span><br>
                    daDeperment.Fill(ds, "部門");<span id="im">Fill方法將查詢結果放到DataSet裡面並命名為員工，產生一個DataTable</span><br><br>
        
                    int n = ds.Tables.Count;<span id="im">獲取這個DataSet裡面有幾個DataTable</span><br><br>
        
                    string s = ds.Tables[0].TableName;<span id="im">獲取第一個DataTable的名稱</span><br>
                    string s2 = ds.Tables[1].TableName;<span id="im">獲取第二個DataTable的名稱</span><br><br>
        
                    textBox1.Text = $"DataSet中的DataTable的總數：{n}\r\n\r\n取得第1個的DataTable的表格名稱：{s}\r\n\r\n取得第2個的DataTable的表格名稱：{s2}";<br><br>
        
                    dataGridView1.DataSource = ds.Tables["員工"];<span id="im">工具箱裡的DataGridView主要是以表格方式來顯示資料，把DataSet裡的員工DataTable帶給dataGridView1</span><br><br>
                    
                    <img src="img/2.png"><br>
                    <span id="im">利用DataSet裡面的DataTable的Name帶給comboBox的Items</span><br>
                    dataGridView1.DataSource = ds.Tables[comboBox1.Text];<span id="im">帶給dataGridView1</span><br><br>
                    <span id="im">Command物件成員ExecuteScalar的用法</span><br>
                    SqlCommand cmdSum = new SqlCommand("SELECT SUM(薪資) FROM 員工", cn);<br>
                    lblSum.Text = $"員工資料表薪資加總共{cmdSum.ExecuteScalar().ToString()}";<br>
                    <span id="im">新增資料</span><br>
                    SqlCommand cmd = new SqlCommand("INSERT INTO 部門(部門編號, 部門名稱) VALUES (4, N'設計')",cn);<br>
                    cmd.ExecuteNonQuery();<br>

                </p>

                
            </div>        
                
        </div>
        
    
</body>
</html>